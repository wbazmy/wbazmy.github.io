---
layout: post
title: IO流
date: 2021-11-22
tags: JavaSE基础
---
## 1. File类
java.io.File类是文件和目录的抽象表示形式。File可以新建删除重命名文件和目录，但不能访问文件内容，要访问文件内容需要用到IO流。  

File常用方法：
![](/images/JavaSE/35.png)

renameTo：要保证成功，file1存在，file2不存在。  
![](/images/JavaSE/36.png)

![](/images/JavaSE/37.png)

## 2. IO概述
IO用于处理设备之间的数据传输，如读写文件，网络通讯等。Java对于数据IO以流的方式进行。java.io包下提供了各种流类和接口，用以获取不同种类的数据，并通过标准的方法输入或输出数据。如read，write等。  
输入（从程序角度看）：读取外部数据到程序（内存）中。  
输出：将程序（内存）数据输出到磁盘中。  
### 流的分类
按操作数据单位不同：字节流，字符流。  
按数据流的流向：输入流，输出流。  
按流的角色的不同：节点流，处理流。
- 节点流：直接建立在文件与程序之间的流。 
- 处理流：以流为构造参数的流（套接在已有流的基础上）。

所有IO类都派生于四个抽象基类：
![](/images/JavaSE/38.png)

派生的子类都是以其父类名为后缀。  
蓝色为重要的流：
![](/images/JavaSE/38.png)

访问文件的四个为基础的节点流。  
### 节点流
FileReader（流内会存在一个指针）：

```java
    public void test1() throws IOException {
        File f = new File("hello.txt");
        FileReader fr = new FileReader(f);
        int i = fr.read(); //返回读入的一个字符，到末尾返回-1
        System.out.println((char) i);
        fr.close(); //别忘了关闭
    }
```

为了防止IO流没有关闭，推荐使用try-catch-finally。  
读入的文件要存在，否则会抛异常。  

```java
    public void test1() throws IOException {
        File f = new File("hello.txt");
        FileReader fr = new FileReader(f);
        char[] c = new char[3];
        int i1 = fr.read(c);  //返回读入到字符数组的字符个数（最多读数组长度个），到末尾返回-1
        System.out.println(c);
        fr.close();
    }
```

FileWriter：

```java
   public void test2() throws IOException {
        File f = new File("hello.txt");
        FileWriter fw = new FileWriter(f，false);  //覆盖原文件，true则在原文件后追加内容
        fw.write("zy"); //会覆盖原文件的内容（默认）
        fw.write("123");//zy123
        fw.write(c,0,3)  //写进字符数组
        fw.close();
    }
```

如果文件不存在会自动创建。  
不能使用字符流来处理非文本文件（图片，视频等），应该使用字节流。  
### 字节流
字节流无法处理文本文件（中文），因为中文用三个字节存（utf-8），普通英文数字用1个字节存。单纯的复制文本文件可以用字节流，因为文件本质都是字节。  
FileInputStream和FileOutputStream的用法和字符流类似，同样有read和write方法，只是操作对象变成了byte[]。  

```java
public void test3() throws IOException {
        File f = new File("1.jpg");
        File f2 = new File("2.jpg");
        FileInputStream fi = new FileInputStream(f);
        FileOutputStream fo = new FileOutputStream(f2);
        byte[] b = new byte[1024];
        int i;
        while ((i = fi.read(b)) != -1) {
            fo.write(b, 0, i);
        }
        fi.close();
        fo.close();

    }
```

### 缓冲流
缓冲流：处理流的一种，可以提高文件的读写效率。  
缓冲流：BufferedInputStream，BufferedOutputStream，BufferedReader，BufferedWriter。  
缓冲流以节点流为构造参数。  

```java
public void test4() throws IOException {
        File f = new File("1.jpg");
        File f2 = new File("3.jpg");
        FileInputStream fi = new FileInputStream(f);
        FileOutputStream fo = new FileOutputStream(f2);
        BufferedInputStream bi = new BufferedInputStream(fi);
        BufferedOutputStream bo = new BufferedOutputStream(fo);
        byte[] b = new byte[1024];
        int len;
        while ((len = bi.read(b)) != -1) {
            bo.write(b, 0, len);
        }
        bi.close();
        bo.close();
        // fi.close();
        // fo.close();

    }
```

关闭流时先关外层的流。关外层流时会自动关内层流。  
效率提高原因：提供了一个缓冲区，先读数据到缓冲区，等缓冲区满了再一次性写入（若没满则会在close时写入剩余的部分）。flush方法可以刷新缓冲区并且将没写的写入。  
BufferedReader和BufferedWriter使用方法类似，但多了个readLine方法，读取的字符串不包含换行符。  
### 转换流
提供了字节流到字符流的相互转换。属于字符流。
- InputStreamReader：将一个字节的输入流转换为字符的输入流。
- OutputStreamWriter：将一个字符的输出（字符数组）转换为字节的输出流。

```java
    public void test5() throws IOException {
        FileInputStream fi = new FileInputStream("hello.txt");
        //使用哪个字符集取决于保存文件时使用的字符集
        InputStreamReader isr = new InputStreamReader(fi, "UTF-8");
        char[] c = new char[10];
        int len;
        while ((len = isr.read(c)) != -1) {
            String s = new String(c, 0, len);
            System.out.print(s);
        }
        isr.close();


    }
```

```java
    public void test5() throws IOException {
        FileInputStream fi = new FileInputStream("hello.txt");
        FileOutputStream fo = new FileOutputStream("hello1-gbk.txt");
        //使用哪个字符集取决于保存文件时使用的字符集
        InputStreamReader isr = new InputStreamReader(fi, "UTF-8");
        OutputStreamWriter osw = new OutputStreamWriter(fo, "gbk");
        char[] c = new char[10];
        int len;
        while ((len = isr.read(c)) != -1) {
            String s = new String(c, 0, len);
            System.out.print(s);
            osw.write(c, 0, len);
        }
        isr.close();
        osw.close();


    }
```

### 字符集
ANSI：指的是平台的默认编码，中文是GBK，英文是ISO-8859-1。  
Unicode是字符编码表，用1到3个字节表示字符，UTF-8是落地方案（编码实现），变长的字符编码方式，1到4字节。  



