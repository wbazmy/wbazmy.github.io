---
layout: post
title: Git使用
date: 2021-11-09
tags: 常用工具使用
---
## 1. Git概述
Git是一个分布式版本控制系统。版本控制是一种记录文件内容变化，以便将来查阅特定版本修订情况的系统。版本控制最重要的是可以记录文件修改历史记录。方便用户查看历史版本和版本切换。  
集中式版本控制工具：SVN。有一台中央服务器用来推送或拉取代码，并保存文件的修订版本，管理员可以设置每个开发者的权限。缺点是单点故障造成都不能提交更新。  
分布式版本控制工具：Git。客户端提取的是完整的代码仓库，而不是单个文件的最新快照，版本控制在本地也可以进行（断网也可以开发），每个客户端保存的都是完整的项目（包含历史记录）。  
工作区：仓库目录。暂存区：用于临时存储，git add命令。本地库：git commit提交到本地库，会生成历史版本，历史版本无法删除。本地库的版本可以推送到远程库，git push。
![](/images/工具使用/1.png)

代码托管中心：远程库。
- 局域网：GitLab。
- 互联网：GitHub，Gitee（码云）。

## 2. Git常用命令
用户签名：git config --global user.name wbazmy, git config --global user.email 111@qq.com。签名的作用是用来区分不同操作者的身份，来看版本提交是谁做的。git首次安装必须设置。这里设置的用户签名和将来登录github的账号没有任何关系。  
初始化本地库：git init，在仓库目录内执行来初始化本地库。  
查看本地库状态：git status。  
添加文件到暂存区：git add file1。删除暂存区的文件：git rm --cached file1。  
将暂存区的文件提交到本地库：会形成历史版本，git commit -m "日志信息" file1。  
查看提交日志：git reflog（精简）, git log（详细信息）。  
文件修改后若要更新到版本历史需重新add和commit。git不使用副本策略维护版本历史，指针会指向最新被提交的版本。head指针指向master分支，master分支指向了相应的版本。  
版本穿梭：若想回到以前的版本，使用git reset --hard 版本号。此时工作区文件也会回到历史版本，并且head指针会指向历史版本。也可以通过版本号回到最新的版本。  
## 3. Git分支
在版本控制过程中，要同时推进多个任务，为每个任务可以创建每个任务的单独分支，可以把开发者的工作从开发主线上分离开来，开发自己的分支时不会影响其他分支的运行。分支的底层也是指针的引用。  
同时并行推进多个功能开发，可以提高开发效率，如果某个分支开发失败不会对其他分支有任何影响。
![](/images/工具使用/2.png)

查看分支：git branch -v。  
创建分支：git branch 分支名。创建的分支自动创建于当前分支（可以看作当前分支的副本）。创建分支的本质就是新创建一个指针。  
切换分支：git checkout 分支名。切换后可以在分支上修改文件（本地上改）并提交。切换分支后head会指向当前分支（分支指向哪个版本取决于会不会更改，更改后则会指向新版本），并且本地文件也会随之改变。切换分支的本质就是移动head指针。  
head指针，分支与版本号的关系：head指针永远指向当前分支，而分支会停留（指向）在某个版本上，会出现多个分支停留（指向）在同一个版本上的情况出现。本地文件永远会是head指针所指的版本。  
合并分支：git merge 分支名。将指定分支合并到当前分支上。若没有出现冲突就会正常完成合并。  
合并冲突：合并分支时，两个分支在同一个文件的同一个位置有两套完全不同的修改（在两个分支上都修改过。另外，git以行为修改单位）。Git无法决定用哪一个，就需要人为决定新代码内容，会进入merging状态。文件中会标出哪块内容发生了冲突，需要在文件中手动处理冲突后重新add和commit（commit时不能加文件名）。  
## 4. 团队协作
团队内协作：
![](/images/工具使用/3.png)

跨团队协作：
![](/images/工具使用/4.png)

pull request：
1. 当你想更正别人仓库里的错误时，要走一个流程：先 fork 别人的仓库，相当于拷贝一份，不会有人直接让你改修原仓库的。
2. clone 到本地分支，做一些 bug fix。
3. 发起 pull request 给原仓库，让他看到你修改的bug。
4. 原仓库 review 这个bug，如果是正确的话，就会 merge 到他自己的项目中。

## 5. GitHub
查看远程仓库地址别名：git remote -v。  
创建别名：git remote add 别名 远程库地址。  
推送到远程库：git push 别名 分支。  
拉取仓库最新版本：git pull 别名 分支。需要身份认证。   
clone仓库：克隆远程仓库，一般用于团队内协作，clone不需要身份认证。git clone 远程库地址。clone会做如下操作：1. 拉取代码。2. 初始化本地仓库。3. 创建别名（远程库地址还是原地址），默认origin。与fork区分开来：clone后始终还在原远程仓库下进行各种操作，要push也是push到原远程仓库。若要push则需要权限。可以在github远程仓库的settings模块的Manage access中邀请协作人，被邀请人接收邀请后就拥有了push权限。  
git clone和git pull：
- clone是在本地没有版本库的时候，从远程服务器克隆整个版本库到本地，是一个本地从无到有的过程。通常情况下，远程操作的第一步，是使用git clone从远程主机克隆一个版本库到本地。
- 在本地有版本库的情况下，从远程库获取最新commit 数据（如果有的话），并merge（合并）到本地。git pull = git fetch + git merge。本地修改代码后，每次从本地仓库push到远程仓库之前都要先进行git pull操作，保证push到远程仓库时没有版本冲突。

fork：将其他代码仓库复制一份到自己的github仓库中，一般用于团队间协作。fork后修改代码会只推送到自己的仓库中，若要推送到原仓库则需要pull request。原仓库用户同意后即可将修改合并到原仓库。有push权限的情况下一般直接用clone，没权限则不能push到原仓库，则需要先fork，然后clone自己的那一个仓库到本地再修改然后push并提交pr。  
ssh免密登录：如果使用ssh链接进行push或pull则需要配置公钥私钥：ssh-keygen -t rsa -C "这里换上你的邮箱"。  

## 6. Git与IDEA
IDEA里的红色文件代表未被追踪，绿色代表没有被commit，白色为正常颜色。蓝色代表被追踪了但有修改。每次更改代码时应先pull一下更新到最新的版本。









